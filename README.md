# Профильное задание на позицию стажёра (Frontend-разработчик)

db.json с данными находится в корне проекта

## Запуск проекта

### Установите зависимости
```bash
   npm i
```

### Запустите сервер
```bash
   npm run server
```

### Запустите проект
```bash
   npm run dev
```


## Описание проекта

Проект представляет собой React-приложение для управления задачами (целями) с возможностью добавления, просмотра, а также управления динамическими полями. Приложение использует:

- TypeScript для строгой типизации
- Vite как сборщик
- TanStack Query для управления серверным состоянием
- Fetch для  API-запросов

## Структура проекта

### Компоненты

#### `App` (`src/components/app/App.tsx`)
**Корневой компонент приложения**, объединяющий функциональность форм и таблицы.

**Функции:**
- Управляет видимостью форм (`AddFieldForm`, `ObjectiveForm`) через состояния `showForm` и `showAddField`
- Реализует бесконечную прокрутку таблицы с помощью `fetchMoreOnBottomReached`
- Рендерит кнопки для добавления записи/поля и контейнер таблицы с прокруткой

**Зависимости:** Использует хук `useObjectives` для получения данных и функций управления

#### `ObjectiveTable` (`src/components/table/objectiveTable.tsx`)
**Компонент таблицы**, отображающий список задач.

**Функции:**
- Рендерит таблицу с использованием `@tanstack/react-table`
- Поддерживает статические (`columns`) и динамические (`dynamicColumns`) столбцы
- Отображает кнопку "Удалить поле" над заголовком динамических столбцов
- Окрашивает ячейки столбца `priority` в зависимости от значения (Низкий, Средний, Высокий) с классами `priorityLow`, `priorityMedium`, `priorityHigh`

**Особенности:** Использует CSS-модуль (`ObjectiveTable.module.css`) для стилизации

#### `AddObjectiveForm` (`src/components/form/AddObjectiveForm.tsx`)
**Форма для добавления новой задачи**.

**Функции:**
- Включает поля: `title`, `description`, `dateStart`, `dateEnd`, `priority`, `status`, и динамические поля
- Использует `react-hook-form` и `zod` для валидации через `ObjectiveSchema`
- Блокирует кнопку отправки при:
  - Отправке формы (`isSubmitting`)
  - Наличии ошибок валидации (`!isValid`)
  - Незаполненных обязательных полях (`isFormIncomplete`)
  - Отсутствии изменений в обязательных полях (`isFormUntouched`, через `dirtyFields`)
- Русифицирует значения `priority` (Низкий, Средний, Высокий) и `status` (Добавить, Исправить)

**Особенности:** Поддерживает динамические поля, переданные через `dynamicFieldKeys`

#### `AddFieldForm` (`src/components/field/AddFieldForm.tsx`)
**Форма для добавления нового динамического поля**.

**Функции:**
- Позволяет ввести имя поля (`newFieldKey`)
- Блокирует кнопку отправки, если:
  - Поле пустое
  - Поле уже существует
  - Достигнут лимит столбцов (15)
- Вызывает `handleAddField` при отправке

**Особенности:** Простая форма с одним полем ввода

### Хуки

#### `useObjectives` (`src/hooks/useObjectives.ts`)
**Кастомный хук для управления данными задач и динамическими полями**.

**Функции:**
- Загружает задачи с пагинацией через `useInfiniteQuery` из TanStack Query
- Предоставляет:
  - `flatData`: Плоский массив задач (`TObjective[]`)
  - `dynamicColumns`: Динамические столбцы для таблицы
  - `addedFieldKeys`: Ключи добавленных полей
  - `isLoading`, `error`, `isFetching`, `hasNextPage`, `fetchNextPage`: Состояние запросов
  - `handleAddObjective`, `handleAddField`, `handleRemoveField`: Функции для управления данными
- Кэширует поля через `useQueryClient`

**Зависимости:** Использует API-функции из `objectives.ts` и утилиту `createDynamicColumns`

### Утилиты

#### `objectives.ts` (`src/api/objectives.ts`)
**Функции для работы с API**.

**Функции:**
- `getObjectives(page: number)`: Получает задачи с пагинацией
- `addObjective(data: TObjective)`: Добавляет новую задачу
- `addField(key: string)`: Добавляет новое поле
- `removeField(key: string)`: Удаляет поле


#### `createDynamicColumns.ts` (`src/utils/createDynamicColumns.ts`)
**Утилита для создания динамических столбцов таблицы**.

**Функции:** Генерирует `ColumnDef` для динамических полей на основе `addedFieldKeys`

#### `validateDates.ts` (`src/utils/validateDates.ts`)
**Утилита для валидации дат**.

**Функции:** Проверяет, что `dateEnd` не раньше `dateStart`

#### `columns.ts` (`src/components/columns/columns.ts`)
**Определяет статические столбцы таблицы**.

**Функции:** Предоставляет `ColumnDef` для полей `title`, `description`, `dateStart`, `dateEnd`, `status`, `priority`

### Типы и схемы

#### `Types.ts` (`src/types/Types.ts`)
Определяет:
- `TObjective` (структура задачи)
- `TObjectivePage` (ответ API с пагинацией)
- `TDynamicColumnDef` (динамические столбцы)

#### `Props.ts` (`src/types/Props.ts`)
Типы пропсов для компонентов:
- `ObjectiveFormProps`
- `AddFieldFormProps`
- `ExtendedObjectiveTableProps`

#### `Objective.ts` (`src/schemas/Objective.ts`)
- Схема `ObjectiveSchema` для валидации формы через Zod
- Тип `TObjectiveForm` для данных формы


### Стили

#### `index.css`
Глобальные стили, включая CSS-переменные

#### `.module.css`
Модульные стили для компонентов

## Управление состоянием

### Выбор инструмента
В проекте не используется отдельный стейт-менеджер, вместо этого управление состоянием в проекте реализовано через:

#### React Hooks
- `useState` в `App.tsx` для локального состояния (`showForm`, `showAddField`, `newFieldKey`)
- `useRef` для ссылки на контейнер таблицы
- `useCallback` для оптимизации функций

#### TanStack Query
- Используется для управления серверным состоянием (загрузка задач, добавление/удаление полей)
- Хук `useObjectives` инкапсулирует логику запросов, кэширования и мутаций
- Обеспечивает автоматическую инвалидацию кэша и повторные запросы

#### React Hook Form
- Управляет состоянием формы в `AddObjectiveForm`, включая валидацию и `dirtyFields`

### Обоснование отсутствия стейт-менеджера

#### Простота приложения
- Приложение имеет ограниченный объём состояния (видимость форм, данные таблицы, поля формы)
- Локальное состояние в компонентах (`useState`) достаточно для управления UI

#### Серверное состояние
- Основная часть данных (задачи, поля) хранится в db.json и управляется через API
- TanStack Query эффективно обрабатывает запросы, кэширование и синхронизацию, устраняя необходимость в глобальном хранилище

#### Модульность
- Хук `useObjectives` изолирует логику работы с данными, делая её переиспользуемой и тестируемой
- Компоненты (`App`, `ObjectiveTable`, формы) независимы и получают данные через пропсы
